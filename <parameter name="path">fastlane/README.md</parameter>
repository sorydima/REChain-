<parameter name="content"># REChain Fastlane Configuration

Automated deployment and release automation for REChain mobile and desktop applications.

## Contents

| File | Description |
|------|-------------|
| Fastfile | Main fastlane configuration |
| Appfile | App-specific configuration |
| Deliverfile | App Store delivery settings |
| metadata/README.md | App metadata templates |

## Quick Start

### Prerequisites

```bash
# Install fastlane
gem install fastlane

# Or via Bundler
gem install bundler
bundle init
echo "gem 'fastlane'" >> Gemfile
bundle install
```

### Basic Commands

```bash
# Run tests
fastlane test

# Build iOS
fastlane ios build

# Build Android
fastlane android build

# Deploy to TestFlight
fastlane ios beta

# Deploy to Google Play
fastlane android beta

# Deploy to App Store
fastlane ios release
fastlane android release
```

## Directory Structure

```
fastlane/
├── Fastfile              # Main configuration
├── Appfile               # App-specific settings
├── Deliverfile           # App Store delivery
├── Fastfile             # iOS-specific lanes
├── Appfile              # iOS-specific config
├── Deliverfile          # iOS delivery settings
├── Fastfile             # Android-specific lanes
├── Appfile              # Android-specific config
├── Deliverfile          # Google Play settings
├── actions/             # Custom actions
├── metadata/            # App metadata
│   ├── android/         # Android metadata
│   └── ios/             # iOS metadata
└── report.xml           # Test report
```

## Available Lanes

### iOS Lanes

| Lane | Description |
|------|-------------|
| ios test | Run iOS tests |
| ios build | Build iOS app |
| ios beta | Deploy to TestFlight |
| ios release | Submit to App Store |
| ios increment_build | Increment build number |
| ios increment_version | Increment version number |
| ios certs | Manage certificates |
| ios match | Sync certificates with match |

### Android Lanes

| Lane | Description |
|------|-------------|
| android test | Run Android tests |
| android build | Build Android app |
| android beta | Deploy to Internal Testing |
| android alpha | Deploy to Alpha |
| android release | Deploy to Production |
| android increment_build | Increment build number |
| android increment_version | Increment version number |

### Common Lanes

| Lane | Description |
|------|-------------|
| all test | Run all tests |
| all build | Build all platforms |
| all beta | Deploy all to beta |
| all release | Release to all stores |
| version_bump | Bump version across all files |

## Configuration

### Environment Variables

```bash
# Create .env file
echo "GIT_URL=https://github.com/sorydima/REChain-.git" > .env
echo "SLACK_URL=https://hooks.slack.com/xxx" >> .env
echo "TEAM_ID=XXXXXXXXXX" >> .env
```

### Required Variables

| Variable | Description |
|----------|-------------|
| GIT_URL | Repository URL |
| SLACK_URL | Slack webhook for notifications |
| TEAM_ID | Apple Developer Team ID |
| APP_STORE_CONNECT_API_KEY | App Store Connect API key |

## CI/CD Integration

### GitHub Actions

```yaml
# .github/workflows/fastlane.yml
name: Fastlane
on:
  push:
    branches: [main, develop]
  pull_request:

jobs:
  test:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.0'
      - name: Install dependencies
        run: bundle install
      - name: Run tests
        run: fastlane ios test
```

### GitLab CI

```yaml
# .gitlab-ci.yml
stages:
  - test
  - build
  - deploy

test:
  stage: test
  script:
    - bundle install
    - fastlane all test

build:
  stage: build
  script:
    - bundle install
    - fastlane ios build
  only:
    - main
```

## Certificates and Profiles

### Using Match

```bash
# Initialize match
fastlane match init

# Generate certificates
fastlane ios match
fastlane ios match development
fastlane ios match appstore

# Use in CI
fastlane ios certs
```

### Manual Certificates

```bash
# Download certificates
fastlane ios certs --type development
fastlane ios certs --type appstore
```

## Testing

### Running Tests

```bash
# All tests
fastlane all test

# iOS only
fastlane ios test

# Android only
fastlane android test

# With coverage
fastlane all test --coverage
```

### Test Options

```bash
# Specific device
fastlane ios test device:"iPhone 14"

# Specific scheme
fastlane ios test scheme:"REChainUITests"

# Parallel execution
fastlane ios test parallel:true
```

## Deployment

### TestFlight Deployment

```bash
# Build and upload
fastlane ios beta

# With changelog
fastlane ios beta changelog:"Bug fixes and improvements"

# Skip build verification
fastlane ios beta skip_build_verification:true
```

### Google Play Deployment

```bash
# Internal testing
fastlane android beta

# Alpha testing
fastlane android alpha

# Production
fastlane android release

# With changelog
fastlane android release changelog:"Major update with new features"
```

### App Store Deployment

```bash
# Build for App Store
fastlane ios release

# With review notes
fastlane ios release review_notes:"New features include..."

# Ship without waiting
fastlane ios release force:true
```

## Version Management

### Bump Version

```bash
# Patch version (1.0.0 -> 1.0.1)
fastlane version_bump type:patch

# Minor version (1.0.0 -> 1.1.0)
fastlane version_bump type:minor

# Major version (1.0.0 -> 2.0.0)
fastlane version_bump type:major

# Custom version
fastlane version_bump version:2.1.0
```

### Update Build Number

```bash
# iOS
fastlane ios increment_build

# Android
fastlane android increment_build

# Both
fastlane all increment_build
```

## Notifications

### Slack Notifications

```bash
# Enable Slack
fastlane ios beta notify_slack:true

# Custom channel
fastlane ios beta slack_channel:"#releases"

# Mention users
fastlane ios beta slack_channel:"#deployments" slack_message:"@team New release!"
```

### Build Notifications

```bash
# Enable test notifications
fastlane ios test notify:true

# Enable deployment notifications
fastlane ios release notify:true
```

## Custom Actions

### Available Actions

| Action | Description |
|--------|-------------|
| set_app_version | Set app version |
| set_build_number | Set build number |
| update_plist | Update Info.plist |
| update_manifest | Update Android manifest |
| commit_version_bump | Commit version changes |
| create_pull_request | Create PR for updates |
| upload_to_s3 | Upload build artifacts |
| notify_slack | Send Slack notification |

### Custom Action Usage

```ruby
# In Fastfile
lane :custom_release do
  set_app_version(version: "1.0.0")
  increment_build_number
  build_ios_app
  upload_to_testflight
  notify_slack(message: "Released 1.0.0")
end
```

## Troubleshooting

### Common Issues

| Issue | Solution |
|-------|----------|
| Certificate expired | Run fastlane match to regenerate |
| Build failed | Check fastlane.log for errors |
| App Store rejected | Review rejection reason in deliverfile |
| Version mismatch | Run fastlane version_bump |

### Debug Mode

```bash
# Verbose logging
fastlane ios build --verbose

# Debug mode
fastlane ios build debug_mode:true
```

### Clean Build

```bash
# Clean iOS build
fastlane ios clean

# Clean Android build
fastlane android clean

# Clean both
fastlane all clean
```

## Best Practices

1. Use Match: Manage certificates securely with fastlane match
2. Increment Versions: Always increment version numbers
3. Test First: Run tests before building
4. Automate Changelog: Generate changelog from commits
5. Notify: Send notifications for all deployments
6. Version Control: Commit version changes
7. Environment Variables: Store secrets in env vars
8. CI Integration: Use in CI/CD pipelines

## Documentation

- Fastlane Docs: https://docs.fastlane.tools
- Match: https://docs.fastlane.tools/actions/match/
- Deliver: https://docs.fastlane.tools/actions/deliver/
- Supply: https://docs.fastlane.tools/actions/supply/

---

**Last Updated**: 2025-01-09
**REChain Version**: 4.2.0
</parameter>
