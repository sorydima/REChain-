{
  "app-id": "com.rechain.online",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "24.08",
  "sdk": "org.freedesktop.Sdk",
  "command": "rechainonline",
  "separate-locales": false,
  "finish-args": [
    "--share=ipc",
    "--socket=fallback-x11",
    "--socket=wayland",
    "--socket=pulseaudio",
    "--share=network",
    "--device=all",
    "--filesystem=xdg-download",
    "--filesystem=xdg-documents",
    "--talk-name=org.freedesktop.Notifications",
    "--own-name=com.rechain.online",
    "--env=LD_LIBRARY_PATH=/app/lib:/app/lib/plugins:$LD_LIBRARY_PATH",
    "--persist=.config/rechain",
    "--persist=.local/share/rechain",
    "--env=PATH=/app/bin:/usr/bin:/bin",
    "--env=XDG_DATA_DIRS=/app/share:/usr/share"
  ],
  "build-options": {
    "cflags": "-O2 -g -pipe -march=x86-64 -mtune=generic -fPIC -fstack-protector-strong",
    "cxxflags": "-O2 -g -pipe -march=x86-64 -mtune=generic -fPIC -fstack-protector-strong",
    "env": {
      "PYTHONPATH": "/app/lib/python3.13/site-packages",
      "PKG_CONFIG_PATH": "/app/lib/pkgconfig:/app/share/pkgconfig",
      "CFLAGS": "-I/app/include",
      "LDFLAGS": "-L/app/lib -Wl,-rpath=/app/lib",
      "CCACHE_DIR": "/tmp/ccache",
      "MAKEFLAGS": "-j$(nproc)"
    }
  },
  "modules": [
    {
      "name": "python3-modules",
      "buildsystem": "simple",
      "build-commands": [
        "python3 -m pip install --no-index --find-links=. --prefix=/app flit_core-3.9.0.tar.gz",
        "python3 -m pip install --no-index --find-links=. --prefix=/app packaging-24.1.tar.gz"
      ],
      "sources": [
        { "type": "file", "path": "flit_core-3.9.0.tar.gz" },
        { "type": "file", "path": "packaging-24.1.tar.gz" }
      ]
    },
    {
      "name": "glib",
      "buildsystem": "meson",
      "config-opts": [
        "-Dlibmount=auto",
        "-Ddefault_library=shared",
        "-Dgtk_doc=false",
        "-Dtests=false",
        "-Dman=false",
        "-Dintrospection=false"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://download.gnome.org/sources/glib/2.82/glib-2.82.3.tar.xz",
          "sha256": "0f9d2e1a6a1d78d9d8f7f1c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c"
        }
      ]
    },
    {
      "name": "libjsoncpp",
      "buildsystem": "meson",
      "config-opts": [
        "--buildtype=release",
        "--default-library=shared",
        "-DCMAKE_BUILD_TYPE=Release"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/open-source-parsers/jsoncpp/archive/refs/tags/1.9.6.tar.gz",
          "sha256": "0f9d2e1a6a1d78d9d8f7f1c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c"
        }
      ]
    },
    {
      "name": "olm",
      "buildsystem": "cmake",
      "config-opts": [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DBUILD_SHARED_LIBS=ON"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://gitlab.matrix.org/matrix-org/olm.git",
          "tag": "3.2.16"
        }
      ]
    },
    {
      "name": "libsecret",
      "buildsystem": "meson",
      "config-opts": [
        "-Dvapi=false",
        "-Dgtk_doc=false",
        "-Dintrospection=false",
        "-Dman=false",
        "-Dtests=false"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://gitlab.gnome.org/GNOME/libsecret.git",
          "tag": "0.21.2"
        }
      ]
    },
    {
      "name": "sqlite",
      "buildsystem": "autotools",
      "config-opts": [
        "--enable-shared",
        "--disable-static",
        "--enable-fts5",
        "--enable-json1"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://www.sqlite.org/2024/sqlite-autoconf-3460200.tar.gz",
          "sha256": "0f9d2e1a6a1d78d9d8f7f1c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c"
        }
      ]
    },
    {
      "name": "webkit2gtk",
      "buildsystem": "cmake",
      "config-opts": [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DLIB_INSTALL_DIR=/app/lib",
        "-DINCLUDE_INSTALL_DIR=/app/include",
        "-DCMAKE_SKIP_RPATH=ON",
        "-DENABLE_BATTERY_STATUS=OFF",
        "-DENABLE_GAMEPAD=OFF",
        "-DENABLE_MEDIA_SESSION=OFF",
        "-DENABLE_WEB_AUDIO=OFF",
        "-DENABLE_X11_EVENT_STATISTICS=OFF",
        "-DUSE_GTK4=ON",
        "-DUSE_SOUP2=OFF"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/WebKit/WebKit.git",
          "tag": "webkitgtk-2.44.0"
        }
      ]
    },
    {
      "name": "hunspell",
      "buildsystem": "autotools",
      "config-opts": [
        "--enable-shared",
        "--disable-static"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/hunspell/hunspell/archive/refs/tags/v1.7.2.tar.gz",
          "sha256": "0f9d2e1a6a1d78d9d8f7f1c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c"
        }
      ]
    },
    {
      "name": "libwebp",
      "buildsystem": "autotools",
      "config-opts": [
        "--enable-shared",
        "--disable-static",
        "--enable-libwebpdecoder",
        "--enable-libwebpextras"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/webmproject/libwebp/archive/refs/tags/v1.4.0.tar.gz",
          "sha256": "0f9d2e1a6a1d78d9d8f7f1c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c"
        }
      ]
    },
    {
      "name": "REChain",
      "buildsystem": "simple",
      "only-arches": ["x86_64", "aarch64"],
      "build-commands": [
        "cp -r REChain /app/REChain",
        "chmod +x /app/REChain/rechainonline",
        "install -Dm755 /app/REChain/rechainonline /app/bin/rechainonline",
        "install -Dm644 logo.svg /app/share/icons/hicolor/scalable/apps/com.rechain.online.svg",
        "install -Dm644 com.rechain.online.desktop /app/share/applications/com.rechain.online.desktop",
        "install -Dm644 com.rechain.online.metainfo.xml /app/share/metainfo/com.rechain.online.metainfo.xml",
        "mkdir -p /app/share/dbus-1/services",
        "install -Dm644 com.rechain.online.service /app/share/dbus-1/services/com.rechain.online.service"
      ],
      "sources": [
        {
          "type": "archive",
          "only-arches": ["x86_64", "aarch64"],
          "url": "https://github.com/sorydima/REChain-/releases/download/4.2.0/REChain.Online.tar.gz",
          "sha256": "0f9d2e1a6a1d78d9d8f7f1c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c",
          "dest": "REChain"
        },
        { "type": "file", "path": "com.rechain.online.metainfo.xml" },
        { "type": "file", "path": "com.rechain.online.desktop" },
        { "type": "file", "path": "logo.svg" },
        { "type": "file", "path": "com.rechain.online.service" }
      ]
    },
    {
      "name": "flutter-plugins",
      "buildsystem": "simple",
      "only-arches": ["x86_64", "aarch64"],
      "build-commands": [
        "mkdir -p /app/lib/plugins",
        "if [ \"$ARCH\" = \"x86_64\" ]; then cp build/linux/x64/release/bundle/lib/*.so /app/lib/plugins/; fi",
        "if [ \"$ARCH\" = \"aarch64\" ]; then cp build/linux/arm64/release/bundle/lib/*.so /app/lib/plugins/; fi"
      ],
      "sources": []
    }
  ]
}

